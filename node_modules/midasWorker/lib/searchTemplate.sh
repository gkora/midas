#!/bin/bash

##
# 
# Usage: AppName $1 $2 $3 
#
# $1 -- Job directory
# $2 -- Job Id
# $3 -- Input file name
# 
##

usage="
Usage: $0 \$1 \$2 \$3 \$4

\$1 -- Job directory
\$2 -- Job Id
\$3 -- Input file name
\$4 -- File Type
"

##
# If the extension of the input file is anything other than FT2, 
#   the append that file with "mzML"
#   Run the following script on the file.
#			- python /home/yf1/project/mzML2FT/mzML2FT.py -w <Current Directory>  -o <Current Directory>

if [ "$#" -ne 4 ]; then
	echo "$usage";
	exit;
fi

## Setup the environment
source <%= source %>

## Change into job directory
cd $1

FT2FileName=$3

if [ "$4" = "mzML" ]; then
    python /home/yf1/project/mzML2FT/mzML2FT.py -w . -o .
    FT2FileName=$(ls *.FT2)
fi

## Execute the search command
python  <%= executableLocation %> -f $FT2FileName -c ./Config.cfg -o $FT2FileName.meb -a $FT2FileName.AFT2 

## Tell the server its done.
curl --data "id=$2" <%= server %> > /dev/null

## I guess all done.

